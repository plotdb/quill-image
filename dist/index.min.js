var quillImageTools,ref$;function import$(e,t){var i,n={}.hasOwnProperty;for(i in t)n.call(t,i)&&(e[i]=t[i]);return e}(quillImageTools=function(e,t){return null==t&&(t={}),this.quill=e,this.root=e.root,this.isActive=!1,this.selectedImage=null,this.overlay=null,this.resizeHandles={},this.dragState=null,this._opt=t,import$(this,t),this.init(),this}).prototype=((ref$=Object.create(Object.prototype)).constructor=quillImageTools,ref$.init=function(){return this.setupStyles(),this.setupEvents(),this.registerModule()},ref$.setupStyles=function(){var e;if(!document.querySelector("#quill-image-tools-styles"))return(e=document.createElement("style")).id="quill-image-tools-styles",e.innerHTML=".quill-image-overlay {\n    position: absolute;\n    border: 2px solid #0066cc;\n    pointer-events: none;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.quill-image-handle {\n    position: absolute;\n    width: 12px;\n    height: 12px;\n    background: #0066cc;\n    border: 2px solid white;\n    border-radius: 2px;\n    pointer-events: auto;\n    cursor: nw-resize;\n    box-sizing: border-box;\n}\n\n.quill-image-handle.se { \n    bottom: -6px; \n    right: -6px; \n    cursor: se-resize; \n}\n\n.quill-image-handle.sw { \n    bottom: -6px; \n    left: -6px; \n    cursor: sw-resize; \n}\n\n.quill-image-handle.ne { \n    top: -6px; \n    right: -6px; \n    cursor: ne-resize; \n}\n\n.quill-image-handle.nw { \n    top: -6px; \n    left: -6px; \n    cursor: nw-resize; \n}\n\n.quill-image-dragging {\n    opacity: 0.5;\n    pointer-events: none;\n}",document.head.appendChild(e)},ref$.setupEvents=function(){var t=this;return this.root.addEventListener("click",function(e){return t.onEditorClick(e)}),document.addEventListener("mousedown",function(e){return t.onMouseDown(e)}),document.addEventListener("mousemove",function(e){return t.onMouseMove(e)}),document.addEventListener("mouseup",function(e){return t.onMouseUp(e)}),document.addEventListener("keydown",function(e){return t.onKeydown(e)})},ref$.registerModule=function(){if(null!=this.quill.register)return this.quill.register("modules/imageTools",quillImageTools)},ref$.onEditorClick=function(e){var t=e.target;return"IMG"===t.tagName?(e.preventDefault(),this.selectImage(t)):this.deselectImage()},ref$.onKeydown=function(e){if("Escape"===e.key)return this.deselectImage()},ref$.onMouseDown=function(e){if(null!=this.overlay)return e.target.classList.contains("quill-image-handle")?(e.preventDefault(),this.startResize(e)):e.target===this.selectedImage?(e.preventDefault(),this.startDrag(e)):void 0},ref$.onMouseMove=function(e){var t;return"resize"===(null!=(t=this.dragState)?t.type:void 0)?this.handleResize(e):"drag"===(null!=(t=this.dragState)?t.type:void 0)?this.handleDrag(e):void 0},ref$.onMouseUp=function(e){if(null!=this.dragState)return this.finishDrag(e)},ref$.selectImage=function(e){return this.deselectImage(),this.selectedImage=e,this.isActive=!0,this.createOverlay(),this.positionOverlay()},ref$.deselectImage=function(){if(this.isActive)return this.isActive=!1,this.selectedImage=null,this.removeOverlay()},ref$.createOverlay=function(){var e,t,i,n,r;if(null!=this.selectedImage){for(this.overlay=document.createElement("div"),this.overlay.className="quill-image-overlay",t=0,i=(e=["nw","ne","sw","se"]).length;t<i;++t)n=e[t],(r=document.createElement("div")).className="quill-image-handle "+n,r.dataset.corner=n,this.overlay.appendChild(r),this.resizeHandles[n]=r;return document.body.appendChild(this.overlay)}},ref$.removeOverlay=function(){if(null!=this.overlay)return this.overlay.remove(),this.overlay=null,this.resizeHandles={}},ref$.positionOverlay=function(){var e,t;if(null!=this.overlay&&null!=this.selectedImage)return e=this.selectedImage.getBoundingClientRect(),(t=this.overlay.style).left=e.left+"px",t.top=e.top+"px",t.width=e.width+"px",t.height=e.height+"px",t},ref$.startResize=function(e){var t=e.target.dataset.corner,i=this.selectedImage.getBoundingClientRect();return this.dragState={type:"resize",corner:t,startX:e.clientX,startY:e.clientY,startWidth:i.width,startHeight:i.height,aspectRatio:i.width/i.height}},ref$.handleResize=function(e){var t,i,n,r,s,l,o;if("resize"===(null!=(t=this.dragState)?t.type:void 0)){switch(i=(t=this.dragState).corner,r=t.aspectRatio,s=e.clientX-t.startX,t.startY,l=n=t.startWidth,o=t.startHeight,i){case"se":o=(l=n+s)/r;break;case"sw":o=(l=n-s)/r;break;case"ne":o=(l=n+s)/r;break;case"nw":o=(l=n-s)/r}return o=(l=Math.max(50,l))/r,(t=this.selectedImage.style).width=l+"px",t.height=o+"px",this.positionOverlay()}},ref$.startDrag=function(e){return this.dragState={type:"drag",startX:e.clientX,startY:e.clientY}},ref$.handleDrag=function(e){var t;null!=(t=this.dragState)&&t.type},ref$.finishDrag=function(e){if(null!=this.dragState)return"resize"===this.dragState.type?this.finishResize():"drag"===this.dragState.type&&this.finishReorder(),this.dragState=null},ref$.finishResize=function(){var e,t,i;if(null!=this.selectedImage&&(e=parseInt(this.selectedImage.style.width),t=parseInt(this.selectedImage.style.height),null!=(i=this.quill.scroll.find(this.selectedImage))))return i=this.quill.getIndex(i),this.quill.formatText(i,1,{width:e+"px",height:t+"px"}),this.positionOverlay()},ref$.finishReorder=function(){return console.log("Drag reorder finished - not yet implemented")},ref$.destroy=function(){return this.deselectImage()},ref$),"undefined"!=typeof window&&null!==window?window.quillImageTools=quillImageTools:module.exports=quillImageTools;
