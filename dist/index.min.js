var Embed,Delta,imagePlusBlot,resizer,ref$;function import$(e,t){var i,r={}.hasOwnProperty;for(i in t)r.call(t,i)&&(e[i]=t[i]);return e}Embed=Quill.import("blots/embed"),Delta=Quill.import("delta"),(imagePlusBlot=function(){return Reflect.construct(Embed,arguments,imagePlusBlot)}).prototype=Object.create(Embed.prototype),(imagePlusBlot.prototype.constructor=imagePlusBlot).prototype.format=function(e,t){return"width"===e||"height"===e?null!=t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):Embed.call(this,e,t)},Object.setPrototypeOf(imagePlusBlot,Embed),(resizer=function(){var a,l=this;return this._={dom:{}},this._.dom.caret=document.createElement("div"),this._.dom.caret.classList.add("quill-image-plus-resizer-caret"),this._.dom.base=document.createElement("div"),this._.dom.base.classList.add("quill-image-plus-resizer-root"),import$(this._.dom,Object.fromEntries(["n","e","s","w"].map(function(e){var t=document.createElement("div");return l._.dom.base.appendChild(t),t.classList.add("quill-image-plus-resizer-bar","quill-image-plus-resizer-bar-"+("n"===e||"s"===e?"horizontal":"vertical")),[e,t]}))),import$(this._.dom,Object.fromEntries(["nw","ne","se","sw"].map(function(e){var t=document.createElement("div");return l._.dom.base.appendChild(t),t.classList.add("quill-image-plus-resizer-dot"),[e,t]}))),a=function(e){var t,i,r,o,n,s,d;return e.stopPropagation(),l._.start&&e.buttons?(e=(t=[e.clientX,e.clientY,l._.dir])[0],r=t[2],o=(t=[e-l._.x,(i=t[1])-l._.y])[0],n=t[1],s=(t=[l._.pos.width,l._.pos.height])[0],d=t[1],/n/.exec(r)&&(n=-n),/w/.exec(r)&&(o=-o),o=(t=Math.abs(o)>Math.abs(n)?[o,o*d/s]:[n*s/d,n])[0],n=t[1],e=(t=l._.pos).x,i=t.y,s=t.width,d=t.height,/n/.exec(r)&&(i=(t=[l._.pos.y-n,l._.pos.height+n])[0],d=t[1]),/s/.exec(r)&&(i=(t=[l._.pos.y,l._.pos.height+n])[0],d=t[1]),/w/.exec(r)&&(e=(t=[l._.pos.x-o,l._.pos.width+o])[0],s=t[1]),/e/.exec(r)&&(e=(t=[l._.pos.x,l._.pos.width+o])[0],s=t[1]),l.repos({x:e,y:i,width:s,height:d,preview:!0})):(window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",a),document.body.classList.toggle("quill-image-plus-select-suppress",!1),l._.previewPos?(n=l._.editor.container.querySelector("[key='"+l._.key+"']"),r=Quill.find(n),o=l._.editor.getIndex(r),l._.editor.formatText(o,1,{width:(t=l._.previewPos).width,height:t.height}),l._.editor.updateContents({ops:[{retain:o},{retain:1,attributes:{width:(t=l._.previewPos).width,height:t.height}}]}),l.bind({node:n,key:l._.key})):void 0)},this._.dom.base.addEventListener("mousedown",function(t){var e,i=["nw","ne","se","sw","n","s","w","e"].filter(function(e){return l._.dom[e]===t.target})[0];if(i)return l._.start=!0,(e=l._).x=t.clientX,e.y=t.clientY,e.dir=i,document.body.classList.toggle("quill-image-plus-select-suppress",!0),window.addEventListener("mousemove",a),window.addEventListener("mouseup",a)}),this}).prototype=((ref$=Object.create(Object.prototype)).dismissCaret=function(){if(this._.dom.caret.parentNode)return this._.dom.caret.parentNode.removeChild(this._.dom.caret)},ref$.caret=function(e){var t,i,r=e.node,e=e.evt,e=[e.clientX,e.clientY],o=e[0],n=e[1],r=r.closest(".ql-container");if(t=document.caretPositionFromPoint(o,n))return this._.dom.caret.parentNode&&this._.dom.caret.parentNode.removeChild(this._.dom.caret),r.appendChild(this._.dom.caret),(i=document.createRange()).setStart(t.offsetNode,t.offset),i.setEnd(t.offsetNode,t.offset),t=i.getBoundingClientRect(),i=r.getBoundingClientRect(),o=(e=[t.x-i.x,t.y-i.y])[0],n=e[1],(e=this._.dom.caret.style).left=o+"px",e.top=n+"px",e},ref$.unbind=function(){return this._.dom.base.style.display="none"},ref$.bind=function(e){var t,i=this,r=e.node,o=e.key,e=e.evt;return this._.dom.base.style.display="block",this._.key=o,e&&!this._.editor?(t=e.target.closest(".ql-container"),this._.editor=Quill.find(e.target.closest(".ql-editor").parentElement),this._.editor.on("text-change",function(){return i.unbind()})):t=this._.editor.container,this._.dom.base.parentNode&&this._.dom.base.parentNode.removeChild(this._.dom.base),t.appendChild(this._.dom.base),o=t.getBoundingClientRect(),t=[(e=r.getBoundingClientRect()).x-o.x,e.y-o.y,e.width,e.height],this.repos({x:t[0],y:t[1],width:t[2],height:t[3]})},ref$.repos=function(e){var t,i,o=this,r=e.x,n=e.y,s=e.width,d=e.height;return e.preview?(t=(i=this._).previewPos||(i.previewPos={})).x=r:(t=(i=this._).pos||(i.pos={})).x=r,[["nw",r,t.y=n],["ne",r+(t.width=s)-8,n],["se",r+s-8,n+(t.height=d)-8],["sw",r,n+d-8]].map(function(e){var t=e[0],t=o._.dom[t].style;return t.transform="translate("+e[1]+"px, "+e[2]+"px)",t}),[["n",r,n,s,0],["e",r+s-3,n,0,d],["s",r,n+d-3,s,0],["w",r,n,0,d]].map(function(e){var t=e[0],i=e[3],r=e[4],t=o._.dom[t].style;return t.transform="translate("+e[1]+"px, "+e[2]+"px)",t.width=(i||3)+"px",t.height=(r||3)+"px",t})},ref$),(ref$=import$(imagePlusBlot,Embed)).blotName="image-plus",ref$.tagName="img",ref$.create=function(e){var a,t;return null==e&&(e={}),imagePlusBlot.resizer||(imagePlusBlot.resizer=new resizer),(a=Embed.create.call(this,e)).setAttribute("src",e.src),a.setAttribute("alt",e.alt||""),a.setAttribute("key",t=e.key||Math.random().toString(36).substring(2)),e.width=200,e.height=300,e.width&&a.setAttribute("width",e.width),e.height&&a.setAttribute("height",e.height),window.addEventListener("mouseup",function(){return imagePlusBlot.resizer.unbind()}),a.setAttribute("draggable",!1),a.addEventListener("mouseup",function(e){return e.stopPropagation()}),a.addEventListener("mousedown",function(e){var d;return imagePlusBlot.resizer.bind({node:a,key:t,evt:e}),d=function(e){var t,i,r,o,n,s;return e.buttons?imagePlusBlot.resizer.caret({node:a,evt:e}):(window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",d),(e=document.caretPositionFromPoint(e.clientX,e.clientY))&&(t=a.getBoundingClientRect(),t=document.caretPositionFromPoint(t.x,t.y))&&a.closest(".ql-editor")&&(t.offsetNode!==e.offsetNode||t.offset!==e.offset-1)&&(t=Quill.find(a.closest(".ql-editor").parentElement),o=Quill.find(a),i=t.getIndex(o),r=Quill.find(e.offsetNode,!0))&&(r=t.getIndex(r)+e.offset,n=(o=o.formats()).width,s=o.height,!(e.offsetNode instanceof Element&&e.offsetNode.childNodes[e.offset]===a))?(i<r&&--r,e=(new Delta).retain(i<r?i:r),e=(e=i<r?e.delete(1):e.insert({"image-plus":((o={src:a.src,alt:a.alt,key:a.key,width:a.width,height:a.height}).transient=!0,o)},{width:n,height:s})).retain(Math.abs(r-i)),e=r<i?e.delete(1):e.insert({"image-plus":((o={src:a.src,alt:a.alt,key:a.key,width:a.width,height:a.height}).transient=!0,o)},{width:n,height:s}),t.updateContents(e),imagePlusBlot.resizer.dismissCaret()):void 0)},window.addEventListener("mousemove",d),window.addEventListener("mouseup",d)}),e.transient&&(a.onload=function(){return imagePlusBlot.resizer.bind({node:a,key:t})}),a},ref$.value=function(t){return Object.fromEntries(["src","alt","width","height","key"].map(function(e){return[e,t.getAttribute(e)]}))},ref$.formats=function(t){return Object.fromEntries(["width","height"].map(function(e){return[e,t.getAttribute(e)||""]}))},Quill.register(imagePlusBlot);
