var Embed,Delta,fit2size,attrname,getfmt,setfmt,imagePlusBlot,resizer,ref$;function import$(e,t){var i,n={}.hasOwnProperty;for(i in t)n.call(t,i)&&(e[i]=t[i]);return e}Embed=Quill.import("blots/embed"),Delta=Quill.import("delta"),fit2size=function(e){return(e=null==e?"":e)&&"fill"!==e?e:"100% 100%"},attrname=function(e){return"width"===e||"height"===e||"alt"===e?e:"key"===e?"data-qip-"+e:"data-"+e},getfmt=function(e){var t,i=e.node,e=e.name;return"width"===e||"height"===e||"mode"===e||"alt"===e||"src"===e?i.getAttribute(attrname(e))||"":(i=i.style,"fit"===e?"100% 100%"!==(t=i.backgroundSize)&&"initial"!==t&&t?t:"fill":"repeat"===e?i.backgroundRepeat||"no-repeat":void 0)},setfmt=function(e){var r,o,t,a=e.node,i=e.name,e=e.value;return"mode"===i&&(e=e||{mode:"free"}[i]),"width"===i||"height"===i||"mode"===i||"alt"===i?null!=e?a.setAttribute(attrname(i),e):a.removeAttribute(attrname(i)):"fit"===i?a.style.backgroundSize=fit2size(e):"repeat"===i?a.style.backgroundRepeat=e||"no-repeat":"src"===i?((r=a._).img={ref:null,loading:!0,sig:Math.random()},r.promise,r.promise=(o=r.img.sig,t=e,new Promise(function(i,e){var n;return r.img.ref=n=new Image,n.onload=function(){var e,t;return o===r.img.sig&&(r.img.loading=!1,(t=r.img).width=n.naturalWidth,t.height=n.naturalHeight,e=(t=[a.getAttribute("width"),a.getAttribute("height")])[0],t=t[1],null==e&&setfmt({node:a,name:"width",value:r.img.width}),null==t)&&setfmt({node:a,name:"height",value:r.img.height}),i()},n.onerror=function(){return o===r.img.sig&&(r.img.loading=!1),i()},n.src=t})),a.setAttribute(attrname(i),e),a.style.backgroundImage="url("+e+")"):void 0},(imagePlusBlot=function(){return Reflect.construct(Embed,arguments,imagePlusBlot)}).prototype=Object.create(Embed.prototype),(imagePlusBlot.prototype.constructor=imagePlusBlot).prototype.format=function(e,t){return setfmt({node:this.domNode,name:e,value:t})},Object.setPrototypeOf(imagePlusBlot,Embed),(resizer=function(){var e,l,u=this;return this._={dom:{}},this._.dom.caret=document.createElement("div"),this._.dom.caret.classList.add("quill-image-plus-resizer-caret"),this._.dom.base=document.createElement("div"),this._.dom.base.classList.add("quill-image-plus-resizer-root"),import$(this._.dom,Object.fromEntries(["n","e","s","w"].map(function(e){var t=document.createElement("div");return u._.dom.base.appendChild(t),t.classList.add("quill-image-plus-resizer-bar","quill-image-plus-resizer-bar-"+("n"===e||"s"===e?"horizontal":"vertical")),[e,t]}))),import$(this._.dom,Object.fromEntries(["nw","ne","se","sw"].map(function(e){var t=document.createElement("div");return u._.dom.base.appendChild(t),t.classList.add("quill-image-plus-resizer-dot"),[e,t]}))),this._.dom.button=e=document.createElement("div"),this._.dom.base.appendChild(e),e.classList.add("quill-image-plus-button"),this._.dom.button.innerHTML='<div data-action="src"><svg xmlns="http://www.w3.org/2000/svg" width="12px" viewBox="0 0 1200 1200"><path d="M1099.8 345.4v-.4a49.8 49.8 0 0 0-9.4-24.6c-.1 0-.2 0-.2-.2l-1.2-1.5-.4-.4-1.2-1.4-.4-.5a50 50 0 0 0-1.6-1.8l-300-300-1.8-1.6-.5-.4-1.4-1.2-.4-.4-1.5-1.2c-.1 0-.2 0-.3-.2l-1.8-1.2A49.7 49.7 0 0 0 755 .2h-.4A50.3 50.3 0 0 0 750 0H150a50 50 0 0 0-50 50v1100a50 50 0 0 0 50 50h900a50 50 0 0 0 50-50V350a49.7 49.7 0 0 0-.2-4.6zM800 170.7 929.3 300H800V170.7zM200 1100V100h500v250a50 50 0 0 0 50 50h250v700H200z"/></svg></div>\n<div data-action="fit"><svg xmlns="http://www.w3.org/2000/svg" width="12px" viewBox="0 0 1200 1200"><path d="M1100 50H100a50 50 0 0 0-50 50v1000a50 50 0 0 0 50 50h1000a50 50 0 0 0 50-50V100a50 50 0 0 0-50-50zm-50 1000H150V150h900v900zM350 900h500a50 50 0 0 0 50-50V350a50 50 0 0 0-50-50H350a50 50 0 0 0-50 50v500a50 50 0 0 0 50 50zm50-500h400v400H400V400z"/></svg></div>\n<div data-action="stretch">â†”</div>\n<div data-action="reset">Reset</div>',this._.dom.button.addEventListener("mousedown",function(e){return e.stopPropagation()}),this._.dom.button.addEventListener("mouseup",function(e){return e.stopPropagation()}),this._.dom.button.addEventListener("click",function(e){var t,i,n,r,o,a;if(e.stopPropagation(),(e=e.target.closest(".quill-image-plus-button > div[data-action]"))&&(t=e.dataset.action,i=Quill.find(u._.tgt.node)))switch(n=u._.editor,r=n.getIndex(i),t){case"src":return n.emitter.emit("image-plus-request-source",{blot:i,index:r,node:u._.tgt.node,currentSrc:getfmt({node:u._.tgt.node,name:"src"}),setSrc:function(e){e=(null!=e?e:{}).src;if(e)return n.formatText(r,1,{src:e})}});case"fit":return a=n.getFormat(r,1).fit||"fill",a=(o=["fill","cover","contain"]).indexOf(a),n.formatText(r,1,{fit:o[(a+1)%o.length]}),u.bind({node:(a=u._.tgt).node,key:a.key});case"stretch":return n.formatText(r,1,{width:"100%"}),u.bind(u._.tgt);case"reset":return a=(o=(null!=(o=u._.tgt.node)&&null!=(a=o._)?a.img:void 0)||{}).width,n.formatText(r,1,{width:a,height:o.height}),u.bind(u._.tgt)}}),l=function(e){var t,i,n,r,o,a,s,d;return e.stopPropagation(),u._.start&&e.buttons?(t=(e=[e.clientX,e.clientY,u._.dir,e.altKey])[0],n=e[2],s=e[3],r=(e=[t-u._.x,(i=e[1])-u._.y])[0],o=e[1],d=(e=[u._.pos.width,u._.pos.height])[0],a=e[1],/n/.exec(n)&&(o=-o),/w/.exec(n)&&(r=-r),s||(u._.resizeBasedAxis||(u._.resizeBasedAxis=Math.abs(r)>Math.abs(o)?"x":"y"),r=(e="x"===u._.resizeBasedAxis?[r,r*a/d]:[o*d/a,o])[0],o=e[1]),t=(e=u._.pos).x,i=e.y,s=e.width,d=e.height,/n/.exec(n)&&(i=(e=[u._.pos.y-o,u._.pos.height+o])[0],d=e[1]),/s/.exec(n)&&(i=(e=[u._.pos.y,u._.pos.height+o])[0],d=e[1]),/w/.exec(n)&&(t=(e=[u._.pos.x-r,u._.pos.width+r])[0],s=e[1]),/e/.exec(n)&&(t=(e=[u._.pos.x,u._.pos.width+r])[0],s=e[1]),u.repos({x:t,y:i,width:s,height:d,preview:!0,mode:getfmt({node:null!=(e=u._.tgt)?e.node:void 0,name:"mode"})})):(window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",l),document.body.classList.toggle("quill-image-plus-select-suppress",!1),u._.previewPos?(o=u._.editor.container.querySelector("[data-qip-key='"+(null!=(a=u._.tgt)?a.key:void 0)+"']"),n=Quill.find(o),r=u._.editor.getIndex(n),u._.editor.formatText(r,1,{width:(t=u._.previewPos).width,height:t.height}),u.bind({node:o,key:null!=(t=u._.tgt)?t.key:void 0})):void 0)},this._.dom.base.addEventListener("mousedown",function(t){var e,i=["nw","ne","se","sw","n","s","w","e"].filter(function(e){return u._.dom[e]===t.target})[0];if(i)return u._.start=!0,(e=u._).x=t.clientX,e.y=t.clientY,e.dir=i,e.resizeBasedAxis=null,document.body.classList.toggle("quill-image-plus-select-suppress",!0),window.addEventListener("mousemove",l),window.addEventListener("mouseup",l)}),this}).prototype=((ref$=Object.create(Object.prototype)).dismissCaret=function(){if(this._.dom.caret.parentNode)return this._.dom.caret.parentNode.removeChild(this._.dom.caret)},ref$.caret=function(e){var t,i,n=e.node,e=e.evt,e=[e.clientX,e.clientY],r=e[0],o=e[1],n=n.closest(".ql-container");if(t=document.caretPositionFromPoint(r,o))return this._.dom.caret.parentNode&&this._.dom.caret.parentNode.removeChild(this._.dom.caret),n.appendChild(this._.dom.caret),(i=document.createRange()).setStart(t.offsetNode,t.offset),i.setEnd(t.offsetNode,t.offset),t=i.getBoundingClientRect(),i=n.getBoundingClientRect(),r=(e=[t.x-i.x,t.y-i.y])[0],o=e[1],(e=this._.dom.caret.style).left=r+"px",e.top=o+"px",e},ref$.unbind=function(){if(this._.dom.base.style.display="none",this._.ro)return this._.ro.unobserve(this._.tgt.node)},ref$.bind=function(e){var t,i,n=this,e=null!=e?e:{},r=e.node,o=e.key,a=e.evt;return this._.dom.base.style.display="block",this._.tgt={key:o,node:r},a&&!this._.editor?(t=a.target.closest(".ql-container"),this._.editor=Quill.find(a.target.closest(".ql-editor").parentElement),this._.editor.on("text-change",function(){return n.unbind()}),this._.ro=new ResizeObserver(function(){return n.bind({node:r,key:o,evt:a})})):t=this._.editor.container,this._.ro.observe(r),this._.dom.base.parentNode&&this._.dom.base.parentNode.removeChild(this._.dom.base),t.appendChild(this._.dom.base),t=t.getBoundingClientRect(),e=[(i=r.getBoundingClientRect()).x-t.x,i.y-t.y,i.width,i.height],this.repos({x:e[0],y:e[1],width:e[2],height:e[3],mode:getfmt({node:r,name:"mode"})})},ref$.repos=function(e){var t,i,o=this,n=e.x,r=e.y,a=e.width,s=e.height,d=null!=(t=e.mode)?t:"free";return a<0&&(n=(t=[n+a,-a])[0],a=t[1]),s<0&&(r=(t=[r+s,-s])[0],s=t[1]),e.preview?(t=(i=this._).previewPos||(i.previewPos={})).x=n:(t=(i=this._).pos||(i.pos={})).x=n,t.y=r,t.width=a,t.height=s,[["nw",n,r],["ne",n+(a=Math.floor(a))-8,r],["se",n+a-8,r+(s=Math.floor(s))-8],["sw",n,r+s-8]].map(function(e){var t=e[0],i=e[2],t=o._.dom[t].style;return t.transform="translate("+Math.floor(e[1])+"px, "+Math.floor(i)+"px)",t.display="auto"!==d?"block":"none",t}),[["n",n,r,a,0],["e",n+a-1,r,0,s],["s",n,r+s-1,a,0],["w",n,r,0,s]].map(function(e){var t=e[0],i=e[2],n=e[3],r=e[4],t=o._.dom[t].style;return t.transform="translate("+Math.floor(e[1])+"px, "+Math.floor(i)+"px)",t.width=(Math.floor(n)||1)+"px",t.height=(Math.floor(r)||1)+"px",t.display="auto"!==d?"block":"none",t}),(t=this._.dom.button.style).transform="translate("+Math.floor(n+8)+"px, "+Math.floor(r+8)+"px)",t},ref$),(ref$=import$(imagePlusBlot,Embed)).blotName="image-plus",ref$.tagName="img",ref$.create=function(e){var a,t,i;return null==e&&(e={}),imagePlusBlot.resizer||(imagePlusBlot.resizer=new resizer),(a=Embed.create.call(this,e))._={opt:{}},a.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="),(t=a.style).backgroundColor="rgba(0,0,0,.8)",t.backgroundPosition="center center",t.backgroundSize="100% 100%",t.backgroundRepeat="no-repeat",a.setAttribute("data-qip-key",i=e.key||"quill-image-plus-"+Math.random().toString(36).substring(2)),window.addEventListener("mouseup",function(){return imagePlusBlot.resizer.unbind()}),a.setAttribute("draggable",!1),a.addEventListener("mouseup",function(e){return e.stopPropagation()}),a.addEventListener("mousedown",function(e){var o;return imagePlusBlot.resizer.bind({node:a,key:i,evt:e}),o=function(e){var n,t,i,r;return e.buttons?(a._.dragging=!0,imagePlusBlot.resizer.caret({node:a,evt:e})):(window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",o),a._.dragging&&(a._.dragging=!1,e=document.caretPositionFromPoint(e.clientX,e.clientY))&&(a.getBoundingClientRect(),a.closest(".ql-editor"))&&(n=Quill.find(a.closest(".ql-editor").parentElement),r=Quill.find(a),t=n.getIndex(r),i=(e=function(e){var t,i=e.offsetNode,e=e.offset;return"#text"!==i.nodeName&&null!=i.childNodes&&(i=(t=[i.childNodes[e<(t=i.childNodes-1)?e:t],0])[0],e=t[1]),{blot:t=Quill.find(i,!0),index:t?n.getIndex(t)+e:0}}(e)).blot,e=e.index,i)&&(i=r.formats(),t<e&&--e,e!==t)?(r=(new Delta).retain(t<e?t:e),r=(r=t<e?r.delete(1):e<t?r.insert({"image-plus":import$({transient:!0},Object.fromEntries(["key"].map(function(e){return[e,a.getAttribute(attrname(e))]})))},i):r).retain(Math.abs(e-t)),r=e<t?r.delete(1):t<e?r.insert({"image-plus":import$({transient:!0},Object.fromEntries(["key"].map(function(e){return[e,a.getAttribute(attrname(e))]})))},i):r,n.updateContents(r),imagePlusBlot.resizer.dismissCaret()):void 0)},window.addEventListener("mousemove",o),window.addEventListener("mouseup",o)}),e.transient&&(a.onload=function(){return imagePlusBlot.resizer.bind({node:a,key:i})}),a},ref$.value=function(t){return Object.fromEntries(["key"].map(function(e){return[e,t.getAttribute(attrname(e))]}))},ref$.formats=function(t){return Object.fromEntries(["width","height","mode","fit","repeat","alt","src"].map(function(e){return[e,getfmt({node:t,name:e})]}))},Quill.register(imagePlusBlot);
