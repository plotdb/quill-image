var Embed,Delta,fit2size,attrname,getfmt,setfmt,pollpos,imagePlusBlot,resizer,ref$;function import$(t,e){var i,n={}.hasOwnProperty;for(i in e)n.call(e,i)&&(t[i]=e[i]);return t}Embed=Quill.import("blots/embed"),Delta=Quill.import("delta"),fit2size=function(t){return(t=null==t?"":t)&&"fill"!==t?t:"100% 100%"},attrname=function(t){return"width"===t||"height"===t||"alt"===t?t:"key"===t?"data-qip-"+t:"data-"+t},getfmt=function(t){var e,i=t.node,t=t.name;return"width"===t||"height"===t||"mode"===t||"alt"===t||"src"===t?i.getAttribute(attrname(t))||"":(i=i.style,"fit"===t?"100% 100%"!==(e=i.backgroundSize)&&"initial"!==e&&e?e:"fill":"repeat"===t?i.backgroundRepeat||"no-repeat":void 0)},setfmt=function(t){var o,r,e,s=t.node,i=t.name,t=t.value;return"mode"===i&&(t=t||{mode:"free"}[i]),"width"===i||"height"===i||"mode"===i||"alt"===i?null!=t?s.setAttribute(attrname(i),t):s.removeAttribute(attrname(i)):"fit"===i?s.style.backgroundSize=fit2size(t):"repeat"===i?s.style.backgroundRepeat=t||"no-repeat":"src"===i?((o=s._).img={ref:null,loading:!0,sig:Math.random()},o.promise,o.promise=(r=o.img.sig,e=t,new Promise(function(i,t){var n;return o.img.ref=n=new Image,n.onload=function(){var t,e;return r===o.img.sig&&(o.img.loading=!1,(e=o.img).width=n.naturalWidth,e.height=n.naturalHeight,t=(e=[s.getAttribute("width"),s.getAttribute("height")])[0],e=e[1],null==t&&setfmt({node:s,name:"width",value:o.img.width}),null==e)&&setfmt({node:s,name:"height",value:o.img.height}),i()},n.onerror=function(){return r===o.img.sig&&(o.img.loading=!1),i()},n.src=e})),s.setAttribute(attrname(i),t),s.style.backgroundImage="url("+t+")"):void 0},pollpos={_:{},bind:function(t){var e=this,i=t.node,t=t.cb,n=!this._.node,o=this._;if(o.node=i,o.cb=t,n)return requestAnimationFrame(function(){return e.tick()})},unbind:function(){return this._.node=null},tick:function(){var t,e,i=this;if(t=this._.node)return t=(e=[(e=this._).box||(e.box={}),t.getBoundingClientRect()])[0],(e=e[1]).x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||this._.cb(),this._.box=t,requestAnimationFrame(function(){return i.tick()})}},(imagePlusBlot=function(){return Reflect.construct(Embed,arguments,imagePlusBlot)}).prototype=Object.create(Embed.prototype),(imagePlusBlot.prototype.constructor=imagePlusBlot).prototype.format=function(t,e){return setfmt({node:this.domNode,name:t,value:e})},Object.setPrototypeOf(imagePlusBlot,Embed),(resizer=function(){var t,u,m=this;return this._={dom:{}},this._.dom.caret=document.createElement("div"),this._.dom.caret.classList.add("quill-image-plus-resizer-caret"),this._.dom.base=document.createElement("div"),this._.dom.base.classList.add("quill-image-plus-resizer-root"),import$(this._.dom,Object.fromEntries(["n","e","s","w"].map(function(t){var e=document.createElement("div");return m._.dom.base.appendChild(e),e.classList.add("quill-image-plus-resizer-bar","quill-image-plus-resizer-bar-"+("n"===t||"s"===t?"horizontal":"vertical")),[t,e]}))),import$(this._.dom,Object.fromEntries(["nw","ne","se","sw"].map(function(t){var e=document.createElement("div");return m._.dom.base.appendChild(e),e.classList.add("quill-image-plus-resizer-dot"),[t,e]}))),this._.dom.button=t=document.createElement("div"),this._.dom.base.appendChild(t),t.classList.add("quill-image-plus-button"),this._.dom.button.innerHTML='<div data-action="src"><svg xmlns="http://www.w3.org/2000/svg" width="12px" viewBox="0 0 1200 1200"><path d="M1099.8 345.4v-.4a49.8 49.8 0 0 0-9.4-24.6c-.1 0-.2 0-.2-.2l-1.2-1.5-.4-.4-1.2-1.4-.4-.5a50 50 0 0 0-1.6-1.8l-300-300-1.8-1.6-.5-.4-1.4-1.2-.4-.4-1.5-1.2c-.1 0-.2 0-.3-.2l-1.8-1.2A49.7 49.7 0 0 0 755 .2h-.4A50.3 50.3 0 0 0 750 0H150a50 50 0 0 0-50 50v1100a50 50 0 0 0 50 50h900a50 50 0 0 0 50-50V350a49.7 49.7 0 0 0-.2-4.6zM800 170.7 929.3 300H800V170.7zM200 1100V100h500v250a50 50 0 0 0 50 50h250v700H200z"/></svg></div>\n<div data-action="fit"><svg xmlns="http://www.w3.org/2000/svg" width="12px" viewBox="0 0 1200 1200"><path d="M1100 50H100a50 50 0 0 0-50 50v1000a50 50 0 0 0 50 50h1000a50 50 0 0 0 50-50V100a50 50 0 0 0-50-50zm-50 1000H150V150h900v900zM350 900h500a50 50 0 0 0 50-50V350a50 50 0 0 0-50-50H350a50 50 0 0 0-50 50v500a50 50 0 0 0 50 50zm50-500h400v400H400V400z"/></svg></div>\n<div data-action="stretch">â†”</div>\n<div data-action="reset">Reset</div>',this._.dom.button.addEventListener("mousedown",function(t){return t.stopPropagation()}),this._.dom.button.addEventListener("mouseup",function(t){return t.stopPropagation()}),this._.dom.button.addEventListener("click",function(t){var e,i,n,o,r,s;if(t.stopPropagation(),(t=t.target.closest(".quill-image-plus-button > div[data-action]"))&&(e=t.dataset.action,i=Quill.find(m._.tgt.node)))switch(n=m._.editor,o=n.getIndex(i),e){case"src":return n.emitter.emit("image-plus-request-source",{blot:i,index:o,node:m._.tgt.node,currentSrc:getfmt({node:m._.tgt.node,name:"src"}),setSrc:function(t){t=(null!=t?t:{}).src;if(t)return n.formatText(o,1,{src:t})}});case"fit":return s=n.getFormat(o,1).fit||"fill",s=(r=["fill","cover","contain"]).indexOf(s),n.formatText(o,1,{fit:r[(s+1)%r.length]}),m.bind({node:(s=m._.tgt).node,key:s.key});case"stretch":return n.formatText(o,1,{width:"100%"}),m.bind(m._.tgt);case"reset":return s=(r=(null!=(r=m._.tgt.node)&&null!=(s=r._)?s.img:void 0)||{}).width,n.formatText(o,1,{width:s,height:r.height}),m.bind(m._.tgt)}}),u=function(t){var e,i,n,o,r,s,a,d,l;return t.stopPropagation(),m._.start&&t.buttons?(i=(e=[t.clientX,t.clientY,m._.dir,t.altKey])[0],o=e[2],d=e[3],r=(e=[i-m._.x,(n=e[1])-m._.y])[0],s=e[1],l=(e=[m._.pos.width,m._.pos.height])[0],a=e[1],/n/.exec(o)&&(s=-s),/w/.exec(o)&&(r=-r),d||(m._.resizeBasedAxis||(m._.resizeBasedAxis=Math.abs(r)>Math.abs(s)?"x":"y"),r=(e="x"===m._.resizeBasedAxis?[r,r*a/l]:[s*l/a,s])[0],s=e[1]),i=(e=m._.pos).x,n=e.y,d=e.width,l=e.height,/n/.exec(o)&&(n=(e=[m._.pos.y-s,m._.pos.height+s])[0],l=e[1]),/s/.exec(o)&&(n=(e=[m._.pos.y,m._.pos.height+s])[0],l=e[1]),/w/.exec(o)&&(i=(e=[m._.pos.x-r,m._.pos.width+r])[0],d=e[1]),/e/.exec(o)&&(i=(e=[m._.pos.x,m._.pos.width+r])[0],d=e[1]),m.repos({x:i,y:n,width:d,height:l,preview:!0,mode:getfmt({node:null!=(e=m._.tgt)?e.node:void 0,name:"mode"})})):(m._.start=!1,t.buttons||(m._.resizing=!1),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",u),document.body.classList.toggle("quill-image-plus-select-suppress",!1),m._.previewPos?(s=m._.editor.container.querySelector("[data-qip-key='"+(null!=(a=m._.tgt)?a.key:void 0)+"']"),o=Quill.find(s),r=m._.editor.getIndex(o),null!=(i=m._.tgt)&&i.node&&(n=m._.tgt.node.parentNode)&&(d=n.getBoundingClientRect(),m._.previewPos.width>=d.width)&&(m._.previewPos.width="100%"),m._.editor.formatText(r,1,{width:(l=m._.previewPos).width,height:l.height}),m.bind({node:s,key:null!=(l=m._.tgt)?l.key:void 0})):void 0)},this._.dom.base.addEventListener("mousedown",function(e){var t,i=["nw","ne","se","sw","n","s","w","e"].filter(function(t){return m._.dom[t]===e.target})[0];if(i)return(t=m._).start=!0,t.resizing=!0,(t=m._).x=e.clientX,t.y=e.clientY,t.dir=i,t.resizeBasedAxis=null,document.body.classList.toggle("quill-image-plus-select-suppress",!0),window.addEventListener("mousemove",u),window.addEventListener("mouseup",u)}),this}).prototype=((ref$=Object.create(Object.prototype)).dismissCaret=function(){if(this._.dom.caret.parentNode)return this._.dom.caret.parentNode.removeChild(this._.dom.caret)},ref$.caret=function(t){var e,i,n=t.node,t=t.evt,t=[t.clientX,t.clientY],o=t[0],r=t[1],n=n.closest(".ql-container");if(e=document.caretPositionFromPoint(o,r))return this._.dom.caret.parentNode&&this._.dom.caret.parentNode.removeChild(this._.dom.caret),n.appendChild(this._.dom.caret),(i=document.createRange()).setStart(e.offsetNode,e.offset),i.setEnd(e.offsetNode,e.offset),e=i.getBoundingClientRect(),i=n.getBoundingClientRect(),o=(t=[e.x-i.x,e.y-i.y])[0],r=t[1],(t=this._.dom.caret.style).left=o+"px",t.top=r+"px",t},ref$.unbind=function(){return this._.dom.base.style.display="none",pollpos.unbind()},ref$.bind=function(t){var e,i,n=this,t=null!=t?t:{},o=t.node,r=t.key,s=t.evt;return this._.dom.base.style.display="block",this._.tgt={key:r,node:o},s&&!this._.editor?(e=s.target.closest(".ql-container"),this._.editor=Quill.find(s.target.closest(".ql-editor").parentElement),this._.editor.on("text-change",function(){return n.unbind()})):e=this._.editor.container,pollpos.bind({node:o,cb:function(){if(!n._.resizing)return n.bind({node:o,key:r,evt:s})}}),this._.dom.base.parentNode&&this._.dom.base.parentNode.removeChild(this._.dom.base),e.appendChild(this._.dom.base),e=e.getBoundingClientRect(),t=[(i=o.getBoundingClientRect()).x-e.x,i.y-e.y,i.width,i.height],this.repos({x:t[0],y:t[1],width:t[2],height:t[3],mode:getfmt({node:o,name:"mode"})})},ref$.repos=function(t){var e,i,r=this,n=t.x,o=t.y,s=t.width,a=t.height,d=null!=(e=t.mode)?e:"free";return s<0&&(n=(e=[n+s,-s])[0],s=e[1]),a<0&&(o=(e=[o+a,-a])[0],a=e[1]),t.preview?(e=(i=this._).previewPos||(i.previewPos={})).x=n:(e=(i=this._).pos||(i.pos={})).x=n,e.y=o,e.width=s,e.height=a,[["nw",n,o],["ne",n+(s=Math.floor(s))-8,o],["se",n+s-8,o+(a=Math.floor(a))-8],["sw",n,o+a-8]].map(function(t){var e=t[0],i=t[2],e=r._.dom[e].style;return e.transform="translate("+Math.floor(t[1])+"px, "+Math.floor(i)+"px)",e.display="auto"!==d?"block":"none",e}),[["n",n,o,s,0],["e",n+s-1,o,0,a],["s",n,o+a-1,s,0],["w",n,o,0,a]].map(function(t){var e=t[0],i=t[2],n=t[3],o=t[4],e=r._.dom[e].style;return e.transform="translate("+Math.floor(t[1])+"px, "+Math.floor(i)+"px)",e.width=(Math.floor(n)||1)+"px",e.height=(Math.floor(o)||1)+"px",e.display="auto"!==d?"block":"none",e}),(e=this._.dom.button.style).transform="translate("+Math.floor(n+8)+"px, "+Math.floor(o+8)+"px)",e},ref$),(ref$=import$(imagePlusBlot,Embed)).blotName="image-plus",ref$.tagName="img",ref$.create=function(t){var s,e,i;return null==t&&(t={}),imagePlusBlot.resizer||(imagePlusBlot.resizer=new resizer),(s=Embed.create.call(this,t))._={opt:{}},s.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="),(e=s.style).backgroundColor="rgba(0,0,0,.8)",e.backgroundPosition="center center",e.backgroundSize="100% 100%",e.backgroundRepeat="no-repeat",s.setAttribute("data-qip-key",i=t.key||"quill-image-plus-"+Math.random().toString(36).substring(2)),window.addEventListener("mouseup",function(){return imagePlusBlot.resizer.unbind()}),s.setAttribute("draggable",!1),s.addEventListener("mouseup",function(t){return t.stopPropagation()}),s.addEventListener("mousedown",function(t){var r;return imagePlusBlot.resizer.bind({node:s,key:i,evt:t}),r=function(t){var n,e,i,o;return t.buttons?(s._.dragging=!0,imagePlusBlot.resizer.caret({node:s,evt:t})):(window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",r),s._.dragging&&(s._.dragging=!1,t=document.caretPositionFromPoint(t.clientX,t.clientY))&&(s.getBoundingClientRect(),s.closest(".ql-editor"))&&(n=Quill.find(s.closest(".ql-editor").parentElement),o=Quill.find(s),e=n.getIndex(o),i=(t=function(t){var e,i=t.offsetNode,t=t.offset;return"#text"!==i.nodeName&&null!=i.childNodes&&(i=(e=[i.childNodes[t<(e=i.childNodes-1)?t:e],0])[0],t=e[1]),{blot:e=Quill.find(i,!0),index:e?n.getIndex(e)+t:0}}(t)).blot,t=t.index,i)&&(i=o.formats(),e<t&&--t,t!==e)?(o=(new Delta).retain(e<t?e:t),o=(o=e<t?o.delete(1):t<e?o.insert({"image-plus":import$({transient:!0},Object.fromEntries(["key"].map(function(t){return[t,s.getAttribute(attrname(t))]})))},i):o).retain(Math.abs(t-e)),o=t<e?o.delete(1):e<t?o.insert({"image-plus":import$({transient:!0},Object.fromEntries(["key"].map(function(t){return[t,s.getAttribute(attrname(t))]})))},i):o,n.updateContents(o),imagePlusBlot.resizer.dismissCaret()):void 0)},window.addEventListener("mousemove",r),window.addEventListener("mouseup",r)}),t.transient&&(s.onload=function(){return imagePlusBlot.resizer.bind({node:s,key:i})}),s},ref$.value=function(e){return Object.fromEntries(["key"].map(function(t){return[t,e.getAttribute(attrname(t))]}))},ref$.formats=function(e){return Object.fromEntries(["width","height","mode","fit","repeat","alt","src"].map(function(t){return[t,getfmt({node:e,name:t})]}))},Quill.register(imagePlusBlot);
