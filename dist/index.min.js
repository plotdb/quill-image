var Embed,Delta,imagePlusBlot,resizer,ref$;function import$(t,e){var i,r={}.hasOwnProperty;for(i in e)r.call(e,i)&&(t[i]=e[i]);return t}Embed=Quill.import("blots/embed"),Delta=Quill.import("delta"),(imagePlusBlot=function(){return Reflect.construct(Embed,arguments,imagePlusBlot)}).prototype=Object.create(Embed.prototype),(imagePlusBlot.prototype.constructor=imagePlusBlot).prototype.format=function(t,e){return"width"===t||"height"===t?null!=e?this.domNode.setAttribute(t,e):this.domNode.removeAttribute(t):"fit"===t?this.domNode.style.backgroundSize=e||"":Embed.call(this,t,e)},Object.setPrototypeOf(imagePlusBlot,Embed),(resizer=function(){var t,d,l=this;return this._={dom:{}},this._.dom.caret=document.createElement("div"),this._.dom.caret.classList.add("quill-image-plus-resizer-caret"),this._.dom.base=document.createElement("div"),this._.dom.base.classList.add("quill-image-plus-resizer-root"),import$(this._.dom,Object.fromEntries(["n","e","s","w"].map(function(t){var e=document.createElement("div");return l._.dom.base.appendChild(e),e.classList.add("quill-image-plus-resizer-bar","quill-image-plus-resizer-bar-"+("n"===t||"s"===t?"horizontal":"vertical")),[t,e]}))),import$(this._.dom,Object.fromEntries(["nw","ne","se","sw"].map(function(t){var e=document.createElement("div");return l._.dom.base.appendChild(e),e.classList.add("quill-image-plus-resizer-dot"),[t,e]}))),this._.dom.button=t=document.createElement("div"),t.classList.add("quill-image-plus-button"),this._.dom.button.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12px" viewBox="0 0 1200 1200"><path d="M1099.8 345.4v-.4a49.8 49.8 0 0 0-9.4-24.6c-.1 0-.2 0-.2-.2l-1.2-1.5-.4-.4-1.2-1.4-.4-.5a50 50 0 0 0-1.6-1.8l-300-300-1.8-1.6-.5-.4-1.4-1.2-.4-.4-1.5-1.2c-.1 0-.2 0-.3-.2l-1.8-1.2A49.7 49.7 0 0 0 755 .2h-.4A50.3 50.3 0 0 0 750 0H150a50 50 0 0 0-50 50v1100a50 50 0 0 0 50 50h900a50 50 0 0 0 50-50V350a49.7 49.7 0 0 0-.2-4.6zM800 170.7 929.3 300H800V170.7zM200 1100V100h500v250a50 50 0 0 0 50 50h250v700H200z"/></svg>',this._.dom.button.addEventListener("mousedown",function(t){return t.stopPropagation()}),this._.dom.button.addEventListener("mouseup",function(t){return t.stopPropagation()}),this._.dom.button.addEventListener("click",function(t){return t.stopPropagation()}),d=function(t){var e,i,r,o,n,s,a;return t.stopPropagation(),l._.start&&t.buttons?(t=(e=[t.clientX,t.clientY,l._.dir])[0],r=e[2],o=(e=[t-l._.x,(i=e[1])-l._.y])[0],n=e[1],s=(e=[l._.pos.width,l._.pos.height])[0],a=e[1],/n/.exec(r)&&(n=-n),/w/.exec(r)&&(o=-o),l._.resizeBasedAxis||(l._.resizeBasedAxis=Math.abs(o)>Math.abs(n)?"x":"y"),o=(e="x"===l._.resizeBasedAxis?[o,o*a/s]:[n*s/a,n])[0],n=e[1],t=(e=l._.pos).x,i=e.y,s=e.width,a=e.height,/n/.exec(r)&&(i=(e=[l._.pos.y-n,l._.pos.height+n])[0],a=e[1]),/s/.exec(r)&&(i=(e=[l._.pos.y,l._.pos.height+n])[0],a=e[1]),/w/.exec(r)&&(t=(e=[l._.pos.x-o,l._.pos.width+o])[0],s=e[1]),/e/.exec(r)&&(t=(e=[l._.pos.x,l._.pos.width+o])[0],s=e[1]),l.repos({x:t,y:i,width:s,height:a,preview:!0})):(window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",d),document.body.classList.toggle("quill-image-plus-select-suppress",!1),l._.previewPos?(n=l._.editor.container.querySelector("[data-qip-key='"+l._.key+"']"),r=Quill.find(n),o=l._.editor.getIndex(r),l._.editor.formatText(o,1,{width:(e=l._.previewPos).width,height:e.height}),l._.editor.updateContents({ops:[{retain:o},{retain:1,attributes:{width:(e=l._.previewPos).width,height:e.height}}]}),l.bind({node:n,key:l._.key})):void 0)},this._.dom.base.addEventListener("mousedown",function(e){var t,i=["nw","ne","se","sw","n","s","w","e"].filter(function(t){return l._.dom[t]===e.target})[0];if(i)return l._.start=!0,(t=l._).x=e.clientX,t.y=e.clientY,t.dir=i,t.resizeBasedAxis=null,document.body.classList.toggle("quill-image-plus-select-suppress",!0),window.addEventListener("mousemove",d),window.addEventListener("mouseup",d)}),this}).prototype=((ref$=Object.create(Object.prototype)).dismissCaret=function(){if(this._.dom.caret.parentNode)return this._.dom.caret.parentNode.removeChild(this._.dom.caret)},ref$.caret=function(t){var e,i,r=t.node,t=t.evt,t=[t.clientX,t.clientY],o=t[0],n=t[1],r=r.closest(".ql-container");if(e=document.caretPositionFromPoint(o,n))return this._.dom.caret.parentNode&&this._.dom.caret.parentNode.removeChild(this._.dom.caret),r.appendChild(this._.dom.caret),(i=document.createRange()).setStart(e.offsetNode,e.offset),i.setEnd(e.offsetNode,e.offset),e=i.getBoundingClientRect(),i=r.getBoundingClientRect(),o=(t=[e.x-i.x,e.y-i.y])[0],n=t[1],(t=this._.dom.caret.style).left=o+"px",t.top=n+"px",t},ref$.unbind=function(){return this._.dom.base.style.display="none"},ref$.bind=function(t){var e,i=this,r=t.node,o=t.key,t=t.evt;return this._.dom.base.style.display="block",this._.key=o,t&&!this._.editor?(e=t.target.closest(".ql-container"),this._.editor=Quill.find(t.target.closest(".ql-editor").parentElement),this._.editor.on("text-change",function(){return i.unbind()})):e=this._.editor.container,this._.dom.base.parentNode&&this._.dom.base.parentNode.removeChild(this._.dom.base),e.appendChild(this._.dom.base),o=e.getBoundingClientRect(),e=[(t=r.getBoundingClientRect()).x-o.x,t.y-o.y,t.width,t.height],this.repos({x:e[0],y:e[1],width:e[2],height:e[3]})},ref$.repos=function(t){var e,i,n=this,r=t.x,o=t.y,s=t.width,a=t.height;return s<0&&(r=(e=[r+s,-s])[0],s=e[1]),a<0&&(o=(e=[o+a,-a])[0],a=e[1]),t.preview?(e=(i=this._).previewPos||(i.previewPos={})).x=r:(e=(i=this._).pos||(i.pos={})).x=r,e.y=o,e.width=s,e.height=a,[["nw",r,o],["ne",r+(s=Math.floor(s))-8,o],["se",r+s-8,o+(a=Math.floor(a))-8],["sw",r,o+a-8]].map(function(t){var e=t[0],i=t[2],e=n._.dom[e].style;return e.transform="translate("+Math.floor(t[1])+"px, "+Math.floor(i)+"px)",e}),[["n",r,o,s,0],["e",r+s-1,o,0,a],["s",r,o+a-1,s,0],["w",r,o,0,a]].map(function(t){var e=t[0],i=t[2],r=t[3],o=t[4],e=n._.dom[e].style;return e.transform="translate("+Math.floor(t[1])+"px, "+Math.floor(i)+"px)",e.width=(Math.floor(r)||1)+"px",e.height=(Math.floor(o)||1)+"px",e}),(e=this._.dom.button.style).transform="translate("+Math.floor(r+8)+"px, "+Math.floor(o+8)+"px)",e},ref$),(ref$=import$(imagePlusBlot,Embed)).blotName="image-plus",ref$.tagName="img",ref$.create=function(t){var d,e,i;return null==t&&(t={}),imagePlusBlot.resizer||(imagePlusBlot.resizer=new resizer),(d=Embed.create.call(this,t)).setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="),d.setAttribute("data-src",t.src),(e=d.style).background="url("+t.src+")",e.backgroundSize=t.fit&&"fill"!==t.fit?t.fit:"100% 100%",e.backgroundColor="rgba(0,0,0,.8)",e.backgroundPosition="center center",d.setAttribute("alt",t.alt||""),d.setAttribute("data-qip-key",i=t.key||"quill-image-plus-"+Math.random().toString(36).substring(2)),t.width=200,t.height=300,t.width&&d.setAttribute("width",t.width),t.height&&d.setAttribute("height",t.height),window.addEventListener("mouseup",function(){return imagePlusBlot.resizer.unbind()}),d.setAttribute("draggable",!1),d.addEventListener("mouseup",function(t){return t.stopPropagation()}),d.addEventListener("mousedown",function(t){var a;return imagePlusBlot.resizer.bind({node:d,key:i,evt:t}),a=function(t){var r,e,i,o,n,s;return t.buttons?(d._dragging=!0,imagePlusBlot.resizer.caret({node:d,evt:t})):(window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",a),d._dragging&&(d._dragging=!1,t=document.caretPositionFromPoint(t.clientX,t.clientY))&&(d.getBoundingClientRect(),d.closest(".ql-editor"))&&(r=Quill.find(d.closest(".ql-editor").parentElement),n=Quill.find(d),e=r.getIndex(n),o=(t=function(t){var e,i=t.offsetNode,t=t.offset;return"#text"!==i.nodeName&&null!=i.childNodes&&(i=(e=[i.childNodes[t<(e=i.childNodes-1)?t:e],0])[0],t=e[1]),{blot:e=Quill.find(i,!0),index:e?r.getIndex(e)+t:0}}(t)).blot,i=t.index,o)&&(o=(t=n.formats()).width,n=t.height,e<i&&--i,i!==e)?(s=(new Delta).retain(e<i?e:i),s=(s=e<i?s.delete(1):i<e?s.insert({"image-plus":import$(((t={alt:d.alt,width:d.width,height:d.height}).transient=!0,t),Object.fromEntries(["src","key"].map(function(t){return[t,d.getAttribute("data-"+t)]})))},{width:o,height:n}):s).retain(Math.abs(i-e)),s=i<e?s.delete(1):e<i?s.insert({"image-plus":import$(((t={alt:d.alt,width:d.width,height:d.height}).transient=!0,t),Object.fromEntries(["src","key"].map(function(t){return[t,d.getAttribute("data-"+t)]})))},{width:o,height:n}):s,r.updateContents(s),imagePlusBlot.resizer.dismissCaret()):void 0)},window.addEventListener("mousemove",a),window.addEventListener("mouseup",a)}),t.transient&&(d.onload=function(){return imagePlusBlot.resizer.bind({node:d,key:i})}),d},ref$.value=function(e){return Object.fromEntries(["src","alt","width","height","key"].map(function(t){return[t,e.getAttribute({src:"data-src",key:"data-qip-key"}[t]||t)]}))},ref$.formats=function(e){var i={fit:"backgroundSize"},t=Object.fromEntries(["width","height"].map(function(t){return[t,e.getAttribute(t)||""]}));return import$(t,Object.fromEntries(["fit"].map(function(t){return[t,e.style[i[t]||t]||""]}))),t},Quill.register(imagePlusBlot);
